{
  "nodes": [
    {
      "id": "startAgentflow_0",
      "type": "agentFlow",
      "position": {
        "x": -800,
        "y": 200
      },
      "data": {
        "id": "startAgentflow_0",
        "label": "Start",
        "version": 1.1,
        "name": "startAgentflow",
        "type": "Start",
        "color": "#7EE787",
        "hideInput": true,
        "baseClasses": [
          "Start"
        ],
        "category": "Agent Flows",
        "description": "Starting point of the agentflow",
        "inputParams": [
          {
            "label": "Input Type",
            "name": "startInputType",
            "type": "options",
            "options": [
              {
                "label": "Chat Input",
                "name": "chatInput",
                "description": "Start the conversation with chat input"
              }
            ],
            "default": "chatInput"
          }
        ],
        "inputAnchors": [],
        "inputs": {
          "startInputType": "chatInput"
        },
        "outputAnchors": [
          {
            "id": "startAgentflow_0-output-startAgentflow",
            "label": "Start",
            "name": "startAgentflow"
          }
        ],
        "outputs": {}
      },
      "width": 116,
      "height": 68
    },
    {
      "id": "stickyNote_purpose",
      "type": "stickyNote",
      "position": {
        "x": -800,
        "y": 50
      },
      "data": {
        "id": "stickyNote_purpose",
        "label": "Sticky Note",
        "version": 1,
        "name": "stickyNoteAgentflow",
        "type": "StickyNote",
        "color": "#fee440",
        "baseClasses": [
          "StickyNote"
        ],
        "category": "Agent Flows",
        "description": "Add notes to the agent flow",
        "inputParams": [
          {
            "label": "",
            "name": "note",
            "type": "string",
            "rows": 1,
            "placeholder": "Type something here",
            "optional": true
          }
        ],
        "inputAnchors": [],
        "inputs": {
          "note": "PURPOSE:\nBatch processing with iteration node. Demonstrates for-each loop where Processor agent executes N times (once per array element), followed by Aggregator that collects results and computes statistics."
        },
        "outputAnchors": [
          {
            "id": "stickyNote_purpose-output-stickyNoteAgentflow",
            "label": "Sticky Note",
            "name": "stickyNoteAgentflow"
          }
        ],
        "outputs": {}
      },
      "width": 300,
      "height": 122
    },
    {
      "id": "agent_planner",
      "position": {
        "x": -400,
        "y": 200
      },
      "data": {
        "id": "agent_planner",
        "label": "Agent.Planner",
        "version": 2.2,
        "name": "agentAgentflow",
        "type": "Agent",
        "color": "#4DD0E1",
        "baseClasses": [
          "Agent"
        ],
        "category": "Agent Flows",
        "description": "Dynamically choose and utilize tools during runtime, enabling multi-step reasoning",
        "inputParams": [
          {
            "label": "Agent ID",
            "name": "agentId",
            "type": "string",
            "placeholder": "agent-id",
            "description": "Unique ID for the agent",
            "id": "agent_planner-input-agentId-string",
            "optional": true
          },
          {
            "label": "Agent Description",
            "name": "agentDescription",
            "type": "string",
            "rows": 3,
            "default": "Batch Planner Agent that extracts and validates arrays for batch processing",
            "description": "Description of what the agent does",
            "id": "agent_planner-input-agentDescription-string"
          },
          {
            "label": "System Prompt",
            "name": "systemPrompt",
            "type": "string",
            "rows": 4,
            "optional": true,
            "placeholder": "You are a helpful assistant",
            "id": "agent_planner-input-systemPrompt-string"
          }
        ],
        "inputAnchors": [],
        "inputs": {
          "agentId": "agent_planner",
          "agentDescription": "Batch Planner Agent that extracts and validates arrays for batch processing",
          "systemPrompt": "You are a Batch Planner Agent specializing in parsing user requests and preparing arrays for batch processing.\n\nYour responsibilities:\n1. Parse user input to extract list of items\n2. Validate that at least 1 item exists\n3. Structure items as JSON array\n4. Store in Flow State: $flow.state.items\n5. Confirm batch size to user\n\nOutput Format:\n{\n  \"items\": [\"item1\", \"item2\", ...],\n  \"count\": N,\n  \"ready\": true\n}\n\nIf no items found, return: {\"ready\": false, \"error\": \"No items to process\"}\n\nUpdate Flow State with:\n- raw_input: original user message\n- items: array of items to process\n- processed_count: 0 (initialize)",
          "agentMessages": "",
          "agentModelConfig": {
            "credential": "Anthropic API Key",
            "modelName": "claude-sonnet-4-5-20250929",
            "temperature": 0.4,
            "streaming": true,
            "agentModel": "chatAnthropic"
          },
          "agentTools": [
            {
              "agentSelectedTool": "currentDateTime",
              "agentSelectedToolRequiresHumanInput": "",
              "agentSelectedToolConfig": {
                "agentSelectedTool": "currentDateTime"
              }
            },
            {
              "agentSelectedTool": "searXNG",
              "agentSelectedToolRequiresHumanInput": "",
              "agentSelectedToolConfig": {
                "apiBase": "https://s.llam.ai",
                "toolName": "searxng-search",
                "toolDescription": "Federated web/meta search. Use when you need fresh facts or sources. Provide a natural-language query; returns a ranked, de-duplicated JSON list of result metadata for follow-up browsing and citation.",
                "headers": "",
                "format": "json",
                "categories": "",
                "engines": "",
                "language": "",
                "pageno": "",
                "time_range": "",
                "safesearch": "",
                "agentSelectedTool": "searXNG"
              }
            }
          ],
          "agentKnowledgeDocumentStores": "",
          "agentKnowledgeVSEmbeddings": "",
          "agentEnableMemory": true,
          "agentMemoryContextKey": "agent_planner_memory",
          "agentModel": "chatAnthropic"
        },
        "outputAnchors": [
          {
            "id": "agent_planner-output-agentAgentflow",
            "name": "agentAgentflow",
            "label": "Agent",
            "description": "Agent",
            "type": "Agent | AgentExecutor"
          }
        ],
        "outputs": {},
        "selected": false
      },
      "type": "agentFlow",
      "width": 300,
      "height": 500,
      "selected": false,
      "positionAbsolute": {
        "x": -400,
        "y": 200
      },
      "dragging": false
    },
    {
      "id": "stickyNote_iteration",
      "type": "stickyNote",
      "position": {
        "x": 0,
        "y": 50
      },
      "data": {
        "id": "stickyNote_iteration",
        "label": "Sticky Note",
        "version": 1,
        "name": "stickyNoteAgentflow",
        "type": "StickyNote",
        "color": "#9C89B8",
        "baseClasses": [
          "StickyNote"
        ],
        "category": "Agent Flows",
        "description": "Add notes to the agent flow",
        "inputParams": [
          {
            "label": "",
            "name": "note",
            "type": "string",
            "rows": 1,
            "placeholder": "Type something here",
            "optional": true
          }
        ],
        "inputAnchors": [],
        "inputs": {
          "note": "ITERATION LOGIC:\nIteration Node takes $flow.state.items array and executes Processor agent once per element. Each execution receives $iteration.current (single item) and returns result. All results collected into $iteration.results array."
        },
        "outputAnchors": [
          {
            "id": "stickyNote_iteration-output-stickyNoteAgentflow",
            "label": "Sticky Note",
            "name": "stickyNoteAgentflow"
          }
        ],
        "outputs": {}
      },
      "width": 300,
      "height": 142
    },
    {
      "id": "iterationAgentflow_0",
      "position": {
        "x": 0,
        "y": 300
      },
      "data": {
        "id": "iterationAgentflow_0",
        "label": "For Each Loop",
        "version": 1,
        "name": "iterationAgentflow",
        "type": "Iteration",
        "color": "#9C89B8",
        "baseClasses": [
          "Iteration"
        ],
        "category": "Agent Flows",
        "description": "Execute the nodes within the iteration block for each item in an array (for-each loop)",
        "inputParams": [
          {
            "label": "Array Input",
            "name": "iterationInput",
            "type": "string",
            "description": "The input array to iterate over. Can be a Flow State variable or node output.",
            "placeholder": "{{ $flow.state.items }} or {{ agentNode.output }}",
            "acceptVariable": true,
            "rows": 4,
            "id": "iterationAgentflow_0-input-iterationInput-string",
            "display": true
          }
        ],
        "inputAnchors": [],
        "inputs": {
          "iterationInput": "{{ $flow.state.items }}"
        },
        "outputAnchors": [
          {
            "id": "iterationAgentflow_0-output-iterationAgentflow",
            "label": "Iteration",
            "name": "iterationAgentflow",
            "description": "Iteration output (array of results from each iteration)"
          }
        ],
        "outputs": {},
        "selected": false
      },
      "type": "iteration",
      "width": 300,
      "height": 251,
      "selected": false,
      "positionAbsolute": {
        "x": 0,
        "y": 300
      },
      "dragging": false
    },
    {
      "id": "agent_processor",
      "position": {
        "x": 400,
        "y": 200
      },
      "data": {
        "id": "agent_processor",
        "label": "Agent.Processor",
        "version": 2.2,
        "name": "agentAgentflow",
        "type": "Agent",
        "color": "#4DD0E1",
        "baseClasses": [
          "Agent"
        ],
        "category": "Agent Flows",
        "description": "Dynamically choose and utilize tools during runtime, enabling multi-step reasoning",
        "inputParams": [
          {
            "label": "Agent ID",
            "name": "agentId",
            "type": "string",
            "placeholder": "agent-id",
            "description": "Unique ID for the agent",
            "id": "agent_processor-input-agentId-string",
            "optional": true
          },
          {
            "label": "Agent Description",
            "name": "agentDescription",
            "type": "string",
            "rows": 3,
            "default": "Batch Processor Agent that analyzes individual items",
            "description": "Description of what the agent does",
            "id": "agent_processor-input-agentDescription-string"
          },
          {
            "label": "System Prompt",
            "name": "systemPrompt",
            "type": "string",
            "rows": 4,
            "optional": true,
            "placeholder": "You are a helpful assistant",
            "id": "agent_processor-input-systemPrompt-string"
          }
        ],
        "inputAnchors": [],
        "inputs": {
          "agentId": "agent_processor",
          "agentDescription": "Batch Processor Agent that analyzes individual items",
          "systemPrompt": "You are a Batch Processor Agent specializing in analyzing individual items within a batch operation.\n\nYour responsibilities:\n1. Receive single item via {{ $iteration.current }}\n2. Perform requested operation (sentiment analysis, validation, transformation)\n3. Return structured result with success indicator\n\nFor Sentiment Analysis:\n- Analyze the text sentiment (positive, negative, neutral)\n- Provide confidence score (0.0-1.0)\n- Include brief justification\n\nOutput Format:\n{\n  \"item\": \"original text\",\n  \"result\": \"positive\" | \"negative\" | \"neutral\",\n  \"confidence\": 0.95,\n  \"reason\": \"Clear positive language and enthusiasm\",\n  \"success\": true\n}\n\nIf processing fails:\n{\n  \"item\": \"original text\",\n  \"success\": false,\n  \"error\": \"error message\"\n}\n\nYou execute ONCE per array element. The iteration system will call you N times.",
          "agentMessages": "",
          "agentModelConfig": {
            "credential": "Anthropic API Key",
            "modelName": "claude-sonnet-4-5-20250929",
            "temperature": 0.4,
            "streaming": true,
            "agentModel": "chatAnthropic"
          },
          "agentTools": [
            {
              "agentSelectedTool": "currentDateTime",
              "agentSelectedToolRequiresHumanInput": "",
              "agentSelectedToolConfig": {
                "agentSelectedTool": "currentDateTime"
              }
            },
            {
              "agentSelectedTool": "searXNG",
              "agentSelectedToolRequiresHumanInput": "",
              "agentSelectedToolConfig": {
                "apiBase": "https://s.llam.ai",
                "toolName": "searxng-search",
                "toolDescription": "Federated web/meta search. Use when you need fresh facts or sources. Provide a natural-language query; returns a ranked, de-duplicated JSON list of result metadata for follow-up browsing and citation.",
                "headers": "",
                "format": "json",
                "categories": "",
                "engines": "",
                "language": "",
                "pageno": "",
                "time_range": "",
                "safesearch": "",
                "agentSelectedTool": "searXNG"
              }
            }
          ],
          "agentKnowledgeDocumentStores": "",
          "agentKnowledgeVSEmbeddings": "",
          "agentEnableMemory": true,
          "agentMemoryContextKey": "agent_processor_memory",
          "agentModel": "chatAnthropic"
        },
        "outputAnchors": [
          {
            "id": "agent_processor-output-agentAgentflow",
            "name": "agentAgentflow",
            "label": "Agent",
            "description": "Agent",
            "type": "Agent | AgentExecutor"
          }
        ],
        "outputs": {},
        "selected": false
      },
      "type": "agentFlow",
      "width": 300,
      "height": 500,
      "selected": false,
      "positionAbsolute": {
        "x": 400,
        "y": 200
      },
      "dragging": false
    },
    {
      "id": "stickyNote_aggregation",
      "type": "stickyNote",
      "position": {
        "x": 800,
        "y": 50
      },
      "data": {
        "id": "stickyNote_aggregation",
        "label": "Sticky Note",
        "version": 1,
        "name": "stickyNoteAgentflow",
        "type": "StickyNote",
        "color": "#4DD0E1",
        "baseClasses": [
          "StickyNote"
        ],
        "category": "Agent Flows",
        "description": "Add notes to the agent flow",
        "inputParams": [
          {
            "label": "",
            "name": "note",
            "type": "string",
            "rows": 1,
            "placeholder": "Type something here",
            "optional": true
          }
        ],
        "inputAnchors": [],
        "inputs": {
          "note": "AGGREGATION:\nAggregator receives full $iteration.results array, computes statistics (success/failure counts, distribution analysis), and creates human-readable summary with batch metrics."
        },
        "outputAnchors": [
          {
            "id": "stickyNote_aggregation-output-stickyNoteAgentflow",
            "label": "Sticky Note",
            "name": "stickyNoteAgentflow"
          }
        ],
        "outputs": {}
      },
      "width": 300,
      "height": 122
    },
    {
      "id": "agent_aggregator",
      "position": {
        "x": 800,
        "y": 200
      },
      "data": {
        "id": "agent_aggregator",
        "label": "Agent.Aggregator",
        "version": 2.2,
        "name": "agentAgentflow",
        "type": "Agent",
        "color": "#4DD0E1",
        "baseClasses": [
          "Agent"
        ],
        "category": "Agent Flows",
        "description": "Dynamically choose and utilize tools during runtime, enabling multi-step reasoning",
        "inputParams": [
          {
            "label": "Agent ID",
            "name": "agentId",
            "type": "string",
            "placeholder": "agent-id",
            "description": "Unique ID for the agent",
            "id": "agent_aggregator-input-agentId-string",
            "optional": true
          },
          {
            "label": "Agent Description",
            "name": "agentDescription",
            "type": "string",
            "rows": 3,
            "default": "Batch Aggregator Agent that summarizes batch processing results",
            "description": "Description of what the agent does",
            "id": "agent_aggregator-input-agentDescription-string"
          },
          {
            "label": "System Prompt",
            "name": "systemPrompt",
            "type": "string",
            "rows": 4,
            "optional": true,
            "placeholder": "You are a helpful assistant",
            "id": "agent_aggregator-input-systemPrompt-string"
          }
        ],
        "inputAnchors": [],
        "inputs": {
          "agentId": "agent_aggregator",
          "agentDescription": "Batch Aggregator Agent that summarizes batch processing results",
          "systemPrompt": "You are a Batch Aggregator Agent specializing in summarizing batch processing results.\n\nYour responsibilities:\n1. Receive full results array from {{ $iteration.results }}\n2. Count successes and failures\n3. Compute summary statistics\n4. Create human-readable summary\n\nAnalysis Steps:\n1. Total items processed: {{ $iteration.results.length }}\n2. Success count: filter(success: true).length\n3. Failure count: filter(success: false).length\n4. Distribution analysis (for sentiment: positive/negative/neutral counts)\n5. Average confidence score (if applicable)\n\nOutput Format:\n{\n  \"processed_count\": 5,\n  \"success_count\": 5,\n  \"failure_count\": 0,\n  \"summary\": {\n    \"positive\": 3,\n    \"negative\": 1,\n    \"neutral\": 1\n  },\n  \"average_confidence\": 0.92,\n  \"message\": \"Batch processing complete. Analyzed 5 items with 100% success rate. Sentiment breakdown: 3 positive, 1 negative, 1 neutral.\"\n}\n\nUpdate Flow State with final statistics:\n- batch_summary: summary object\n- processed_count: total processed\n- success_count: successful operations\n- failure_count: failed operations",
          "agentMessages": "",
          "agentModelConfig": {
            "credential": "Anthropic API Key",
            "modelName": "claude-sonnet-4-5-20250929",
            "temperature": 0.4,
            "streaming": true,
            "agentModel": "chatAnthropic"
          },
          "agentTools": [
            {
              "agentSelectedTool": "currentDateTime",
              "agentSelectedToolRequiresHumanInput": "",
              "agentSelectedToolConfig": {
                "agentSelectedTool": "currentDateTime"
              }
            },
            {
              "agentSelectedTool": "searXNG",
              "agentSelectedToolRequiresHumanInput": "",
              "agentSelectedToolConfig": {
                "apiBase": "https://s.llam.ai",
                "toolName": "searxng-search",
                "toolDescription": "Federated web/meta search. Use when you need fresh facts or sources. Provide a natural-language query; returns a ranked, de-duplicated JSON list of result metadata for follow-up browsing and citation.",
                "headers": "",
                "format": "json",
                "categories": "",
                "engines": "",
                "language": "",
                "pageno": "",
                "time_range": "",
                "safesearch": "",
                "agentSelectedTool": "searXNG"
              }
            }
          ],
          "agentKnowledgeDocumentStores": "",
          "agentKnowledgeVSEmbeddings": "",
          "agentEnableMemory": true,
          "agentMemoryContextKey": "agent_aggregator_memory",
          "agentModel": "chatAnthropic"
        },
        "outputAnchors": [
          {
            "id": "agent_aggregator-output-agentAgentflow",
            "name": "agentAgentflow",
            "label": "Agent",
            "description": "Agent",
            "type": "Agent | AgentExecutor"
          }
        ],
        "outputs": {},
        "selected": false
      },
      "type": "agentFlow",
      "width": 300,
      "height": 500,
      "selected": false,
      "positionAbsolute": {
        "x": 800,
        "y": 200
      },
      "dragging": false
    },
    {
      "id": "directReplyAgentflow_0",
      "type": "agentFlow",
      "position": {
        "x": 1200,
        "y": 200
      },
      "data": {
        "id": "directReplyAgentflow_0",
        "label": "Direct Reply",
        "version": 1,
        "name": "directReplyAgentflow",
        "type": "DirectReply",
        "color": "#FFA726",
        "baseClasses": [
          "DirectReply"
        ],
        "category": "Agent Flows",
        "description": "Reply directly without agent processing",
        "inputParams": [
          {
            "label": "Reply Input",
            "name": "directReplyInput",
            "type": "string",
            "rows": 4,
            "placeholder": "{{ $flow.state.message }}",
            "acceptVariable": true,
            "description": "The message to reply with",
            "id": "directReplyAgentflow_0-input-directReplyInput-string"
          }
        ],
        "inputAnchors": [],
        "inputs": {
          "directReplyInput": "{{ $flow.state.batch_summary.message }}"
        },
        "outputAnchors": [
          {
            "id": "directReplyAgentflow_0-output-directReplyAgentflow",
            "label": "Direct Reply",
            "name": "directReplyAgentflow"
          }
        ],
        "outputs": {}
      },
      "width": 300,
      "height": 180
    }
  ],
  "edges": [
    {
      "source": "startAgentflow_0",
      "sourceHandle": "startAgentflow_0-output-startAgentflow",
      "target": "agent_planner",
      "targetHandle": "agent_planner-input-agentAgentflow",
      "type": "buttonedge",
      "id": "startAgentflow_0-startAgentflow_0-output-startAgentflow-agent_planner-agent_planner-input-agentAgentflow"
    },
    {
      "source": "agent_planner",
      "sourceHandle": "agent_planner-output-agentAgentflow",
      "target": "iterationAgentflow_0",
      "targetHandle": "iterationAgentflow_0-input-iterationAgentflow",
      "type": "buttonedge",
      "id": "agent_planner-agent_planner-output-agentAgentflow-iterationAgentflow_0-iterationAgentflow_0-input-iterationAgentflow"
    },
    {
      "source": "iterationAgentflow_0",
      "sourceHandle": "iterationAgentflow_0-output-iterationAgentflow",
      "target": "agent_processor",
      "targetHandle": "agent_processor-input-agentAgentflow",
      "type": "buttonedge",
      "id": "iterationAgentflow_0-iterationAgentflow_0-output-iterationAgentflow-agent_processor-agent_processor-input-agentAgentflow"
    },
    {
      "source": "agent_processor",
      "sourceHandle": "agent_processor-output-agentAgentflow",
      "target": "agent_aggregator",
      "targetHandle": "agent_aggregator-input-agentAgentflow",
      "type": "buttonedge",
      "id": "agent_processor-agent_processor-output-agentAgentflow-agent_aggregator-agent_aggregator-input-agentAgentflow"
    },
    {
      "source": "agent_aggregator",
      "sourceHandle": "agent_aggregator-output-agentAgentflow",
      "target": "directReplyAgentflow_0",
      "targetHandle": "directReplyAgentflow_0-input-directReplyAgentflow",
      "type": "buttonedge",
      "id": "agent_aggregator-agent_aggregator-output-agentAgentflow-directReplyAgentflow_0-directReplyAgentflow_0-input-directReplyAgentflow"
    }
  ]
}
